!function(t,e){function i(){this.active=!1,this.g=function(t,e){return!this.active&&(this.active=!0,this.h=e,this.i=t,this.x=S(e),this.y=S(t),this.arc=0,!0)},this.j=function(){this.active=!1},this.k=null,this.l=function(t){this.k=null;let e=N.atan2(bots[t].y-this.y,bots[t].x-this.x);if(bots[t].i===this.i&&bots[t].h===this.h)return void(this.k=t);if(d(e,m(this.arc+L),L)){let e=[],i=new a(bots[t].x-this.x,bots[t].y-this.y);for(let n of ut){let t=g(n,i,this);t&&e.push({m:t,o:n})}let o=k(bots[t],this);e.length?(e.sort((t,e)=>k(t.m,this)-k(e.m,this)),k(e[0].m,this)>o&&(this.k=t)):this.k=t}}}function n(t){bt=t/500}function o(t){let e=I(Qt),i=qt.i,n=qt.h;for(yt.push({i:i,h:n});0!=e[i][n].dir;){switch(e[i][n].dir){case 1:n--;break;case 2:i--;break;case 3:n++;break;case 4:i++}yt.push({i:i,h:n})}let o,r={};for(let i=0;i<t;i++)for(;;){r.i=~~(N.random()*kt),r.h=~~(N.random()*mt);let t=new s(r.i,r.h);if(o=q(t),o.p>2){bots.push(t);break}}yt=[]}function s(t,e){this.i=t,this.h=e,this.x=S(this.h),this.y=S(this.i),this.dir=0,this.q=!1,this.s=!1,this.t={i:this.i,h:this.h},this.u=function(){let t,e={};for(;;)if(e.i=~~(N.random()*kt),e.h=~~(N.random()*mt),this.i=e.i,this.h=e.h,t=q(this),t.p>2)break;this.x=S(this.h),this.y=S(this.i),this.dir=0,this.q=!1,this.s=!1}}function r(t){Tt=c(t/8*(rt/10))}function h(t,e){this.p=t,this.dir=e}function l(t,e,i){this.v=t,this.r=e,this.A=i}function a(t=0,e=0){this.x=t,this.y=e,this.B=function(t){return u(this.x,t.x)&&u(this.y,t.y)},this.rotate=function(t){let e=this.x,i=this.y,n=N.cos(t)*e-N.sin(t)*i,o=N.sin(t)*e+N.cos(t)*i;return new a(n,o)}}function f(t,e){this.a=t,this.b=e,this.B=function(t){return this.a.B(t.a)&&this.b.B(t.b)},this.vertical=function(){return u(this.a.x,this.b.x)},this.C=function(){return u(this.a.y,this.b.y)},this.concat=function(t){this.b=t.b},this.D=function(t){if(u(t.b.y,this.a.y)&&u(t.b.x,this.a.x)){if(u(t.a.x,t.b.x)&&u(this.a.x,this.b.x))return!0;if(u(t.a.y,t.b.y)&&u(this.a.y,this.b.y))return!0}return!1}}function c(t){return t+.5|0}function d(t,e,i){return m(m(t)-m(e))<i||m(m(e)-m(t))<i}function u(t,e){return N.abs(t-e)<nt}function y(t,e){if(e.vertical()){if(w(e.a.y,t.y,e.b.y))return N.abs(t.x-e.a.x)}else if(w(e.a.x,t.x,e.b.x))return N.abs(t.y-e.a.y);let i=N.min(k(t,e.a),k(t,e.b));return N.sqrt(i)}function x(t,e){for(let i of t)if(i.a===e.a&&i.b===e.b)return!1;return!0}function b(t){let e=[];for(let i=0;i<t.length;i++)e.some(e=>e.B(t[i].a))||e.push(t[i].a),e.some(e=>e.B(t[i].b))||e.push(t[i].b);return e}function p(t,e,i=true){xt=[];let n=b(t);n=n.filter(t=>k(e,t)<=ft);let o=[];for(let s of n){let t=new a(s.x-e.x,s.y-e.y),n=N.atan2(t.y,t.x);i&&d(n,Gt.angle,L)&&(o.push(t.rotate(.01)),o.push(t.rotate(-.01))),i||(o.push(t.rotate(.01)),o.push(t.rotate(-.01)))}let r=new a(Gt.x,Gt.y);o.push(r.rotate(L)),o.push(r.rotate(-L));let h=[];for(let l of o){h=[];for(let i of t){let t=g(i,l,e);t&&k(e,t)<=ft&&h.push({m:t,o:i})}h.length&&(h.sort((t,i)=>k(t.m,e)-k(i.m,e)),x(xt,h[0].o)&&xt.push(h[0].o))}}function w(t,e,i){return e>=t&&e<=i||e>=i&&e<=t}function g(t,e,i){if(t.vertical()){let n=(t.a.x-i.x)/e.x;if(n>0){let o=i.y+e.y*n;if(w(t.a.y,o,t.b.y))return{x:t.a.x,y:o}}}else{let n=(t.a.y-i.y)/e.y;if(n>0){let o=i.x+e.x*n;if(w(t.a.x,o,t.b.x))return{x:o,y:t.a.y}}}return null}function m(t){return t<0?t+=2*G:(t>=2*G&&(t%=2*G),t)}function k(t,e){return N.pow(t.x-e.x,2)+N.pow(t.y-e.y,2)}function v(t){return t.x*t.x+t.y*t.y}function P(t,e,i=qt,n=D){let o=new a(t.x-e.x,t.y-e.y),s=N.sqrt(v(o));o.x/=s,o.y/=s;let r=new a(t.x+o.x,t.y+o.y),h=new a(e.x-o.x,e.y-o.y),l=N.sqrt(k(r,i)),f=N.sqrt(k(h,i)),c=N.abs(l-at),d=N.abs(f-at),y={x:(r.x-i.x)*(c/l),y:(r.y-i.y)*(c/l)},x={x:(h.x-i.x)*(d/f),y:(h.y-i.y)*(d/f)},b=0,p=0;u(r.x,h.x)?b=N.sign(y.x)*at:p=N.sign(y.y)*at,n.lineWidth=1,n.beginPath(),n.moveTo(r.x,r.y),n.lineTo(r.x+y.x,r.y+y.y),n.lineTo(r.x+y.x+b,r.y+y.y+p),n.lineTo(h.x+x.x+b,h.y+x.y+p),n.lineTo(h.x+x.x,h.y+x.y),n.lineTo(h.x,h.y),n.lineTo(r.x,r.y),n.fill(),n.closePath()}function T(t,e,i){for(let n of Jt[t])i[n].A=e,Jt[e].push(n);Jt[t]=[]}function S(t){return t*ot+tt+ot/2}function C(t){let e=document.getElementById("msg"),i=e.style.width=window.innerWidth/5,n=e.style.height=window.innerHeight/5,o=[{x:S(0),y:S(0)},{x:S(mt-1)-i,y:S(0)},{x:S(mt-1)-i,y:S(kt-1)-n},{x:S(0),y:S(kt-1)-n}],s=k(qt,o[0]),r=o[0];for(let h of o){let t=k(qt,h);t>s&&(s=t,r=h)}e.style.left=r.x+"px",e.style.top=r.y+"px",e.style.color="#1dfc81",e.style.font="20px Courier New",e.style.textShadow="1px 1px 20px #fff",e.innerHTML=t}function I(t){let e=[];for(let i=0;i<kt;i++)e.push(new Array);let i=parseInt(t.i),n=parseInt(t.h),o=["last"];e[i][n]=new h(0,0);do 1!=Et[i][n].r&&(!e[i][n+1]||n+1<mt&&e[i][n+1]&&e[i][n+1].p>e[i][n].p+1)?(e[i][n+1]=new h(e[i][n].p+1,1),o.push({a:i,b:n}),n+=1):1!=Et[i][n].v&&(!e[i+1][n]||i+1<kt&&e[i+1][n]&&e[i+1][n].p>e[i][n].p+1)?(e[i+1][n]=new h(e[i][n].p+1,2),o.push({a:i,b:n}),i+=1):n>0&&1!=Et[i][n-1].r&&(!e[i][n-1]||n>0&&e[i][n-1]&&e[i][n-1].p>e[i][n].p+1)?(e[i][n-1]=new h(e[i][n].p+1,3),o.push({a:i,b:n}),n-=1):i>0&&1!=Et[i-1][n].v&&(!e[i-1][n]||i>0&&e[i-1][n]&&e[i-1][n].p>e[i][n].p+1)?(e[i-1][n]=new h(e[i][n].p+1,4),o.push({a:i,b:n}),i-=1):o.length&&(vt=o.pop(),i=vt.a,n=vt.b);while(o.length>0);return e}function A(t,e){let i=new a(e.x-t.x,e.y-t.y),n=N.sqrt(v(i));i.x/=n,i.y/=n;let o=i.rotate(O);z.strokeStyle="white",z.beginPath(),z.lineWidth=1,z.moveTo(t.x,t.y);let s=n/15;for(let r=1;r<s;r++){let e=20*N.random()-10;z.lineTo(t.x+i.x*(r/s)*n+o.x*e,t.y+i.y*(r/s)*n+o.y*e)}z.lineTo(e.x,e.y),z.stroke(),z.closePath(),z.beginPath(),z.lineWidth=2,z.moveTo(t.x,t.y);for(let r=1;r<s;r++){let e=10*N.random()-5;z.lineTo(t.x+i.x*(r/s)*n+o.x*e,t.y+i.y*(r/s)*n+o.y*e)}z.lineTo(e.x,e.y),z.stroke(),z.closePath()}function B(){let t=Ut-yt.length+1;if(0==t){qt.h==Qt.h&&qt.i==Qt.i&&(fixTip={x:S(0),y:40+Bt.width/2},tipWire=0,wt=!0);let t=yt[yt.length-2];t.h<qt.h?qt.stop=1:t.i<qt.i?qt.stop=2:t.h>qt.h?qt.stop=3:t.i>qt.i&&(qt.stop=4)}else qt.stop=!1;j.shadowColor="red",j.shadowBlur=14,j.beginPath(),j.clearRect(420,0,70,50),j.font="bold 20px Courier New",j.fillStyle="#bc0010",j.fillText(t+"",440,20),j.closePath(),j.shadowBlur=0}function W(){j.clearRect(700,0,100,ot);let t=0;for(let e in Pt)Pt[e].active||j.drawImage(Bt,c(700+33*t++),6,22,22);dt=!1}function R(){j.clearRect(tt,40,ot*mt,ot*(kt+1)),j.clearRect(tt,0,tt,tt),j.drawImage(Bt,c(S(0)-Bt.width/2),40),j.beginPath(),j.moveTo(S(0),40+Bt.width);let t=0;for(pt=null;t<yt.length-1;t++){j.lineTo(S(yt[t].h),S(yt[t].i));for(let e of bots)if(e.i==yt[t].i&&e.h==yt[t].h){pt=t;break}if(null!==pt)break}if(j.shadowColor="#f00",j.shadowBlur=ot/5,j.lineWidth=4,j.strokeStyle="#680002",j.stroke(),j.lineWidth=1,j.strokeStyle="#bc0010",j.stroke(),j.closePath(),j.shadowBlur=0,t<yt.length-1){for(j.beginPath(),j.moveTo(S(yt[t].h),S(yt[t].i)),t++;t<yt.length-1;t++)j.lineTo(S(yt[t].h),S(yt[t].i));j.lineWidth=4,j.strokeStyle="#330000",j.stroke(),j.lineWidth=1,j.strokeStyle="#4d0000",j.stroke(),j.closePath()}for(let t in Pt)Pt[t].active&&j.drawImage(Bt,N.round(Pt[t].x-Bt.width/2),N.round(Pt[t].y-Bt.width/2))}function F(){let t=I(qt),e=new h(0,0);for(let i in t)for(let n in t[i])t[i][n].p>e.p&&(e=t[i][n],e.i=i,e.h=n);return e}function q(t){if(yt.length){t.F=I(t);let e=new h(1/0,0);for(let i of yt)t.F[i.i][i.h].p<e.p&&(e.dir=t.F[i.i][i.h].dir,e.p=t.F[i.i][i.h].p,e.i=i.i,e.h=i.h);let n=e.i,o=e.h,s=e.dir;for(t.F[n][o].dir=0;0!==s;)switch(s){case 1:o--,s=t.F[n][o].dir,t.F[n][o].dir=3;break;case 2:n--,s=t.F[n][o].dir,t.F[n][o].dir=4;break;case 3:o++,s=t.F[n][o].dir,t.F[n][o].dir=1;break;case 4:n++,s=t.F[n][o].dir,t.F[n][o].dir=2}return e}return t.F=I(qt),qt}function E(t){let e=document.createElement("canvas");e.width=t.width,e.height=t.height,glctx=e.getContext("2d");let i=e.width/20,n=()=>{return N.random()*t.height},o=e=>{return N.random()*(t.height-e)},s=()=>{return N.random()*i-i/2};for(let r=0;r<2;r++){let e=n(),i=o(e),r=s();glctx.drawImage(t,0,e,t.width,i,r,e,t.width,i)}return e}function H(t,e,n){function s(){X.beginPath(),V=D.createPattern(U,"repeat"),X.fillStyle=V,X.fillRect(tt,tt,mt*ot,kt*ot),X.closePath(),X.shadowColor="#fff",X.shadowBlur=ot/2,X.strokeStyle="#1dfc81",X.fillStyle="#1dfc81",X.lineWidth=ot/20,ut.map(t=>{X.beginPath(),X.moveTo(t.a.x,t.a.y),X.lineTo(t.b.x,t.b.y),X.stroke(),X.closePath()}),ut.map(t=>{X.beginPath(),X.fillRect(t.a.x-ot/40,t.a.y-ot/40,ot/20,ot/20),X.fillRect(t.b.x-ot/40,t.b.y-ot/40,ot/20,ot/20),X.closePath()}),X.shadowBlur=0,j.shadowColor="white",j.shadowBlur=20,j.beginPath(),j.font="20px Courier New",j.fillStyle="#1dfc81",j.fillText("wire_left: ",300,20),j.fillText("defenders_left: ",500,20),j.fillText("internalness: "+intrnlns,810,20),j.closePath(),j.shadowBlur=0}mt=e,intrnlns=t,ht=n,D.clearRect(0,0,Z,$),X.clearRect(0,0,Z,$),j.clearRect(0,0,Z,$),z.clearRect(0,0,Z,$),it=!1,ot=~~((Z-tt)/mt),kt=~~(($-tt)/ot),nt=ot/18,st=ot/2,rt=N.sqrt(ot),lt=ot/128,at=2.5*ot,ft=at*at,ct=2*ot,dt=!0,ut=[],yt=[],xt=[],pt=null,wt=!1,ee=30,gt={G:ot,H:ot,I:ot,J:ot},Pt=[],bots=[];for(let r=0;r<ht;r++)Pt.push(new i);Tt=2,St=document.createElement("canvas"),St.width=St.height=ct,Ct=St.getContext("2d"),Ct.beginPath(),It=new a(N.cos(L),N.sin(L)),It=It.rotate(O),At=Ct.createLinearGradient(0-It.x*ct,0-It.y*ct,0+It.x*ct,0+It.y*ct),At.addColorStop(0,"red"),At.addColorStop(1,"transparent"),Ct.fillStyle=At,Ct.moveTo(0,0),Ct.lineTo(ct,0),Ct.lineWidth=4,Ct.strokeStyle="red",Ct.stroke(),Ct.arc(0,0,ct,0,O),Ct.fill(),Ct.closePath(),Bt=document.createElement("canvas"),Bt.width=Bt.height=c(ot/5),Wt=Bt.getContext("2d"),Wt.beginPath(),Wt.fillStyle="#680002",Wt.fillRect(c(Bt.width/2-ot/10),c(Bt.width/2-ot/10),c(ot/5),c(ot/5)),Wt.fillStyle="#bc0010",Wt.shadowBlur=0,Wt.fillRect(Bt.width/2-ot/14,Bt.width/2-ot/14,ot/7,ot/7),Wt.closePath(),Rt=document.createElement("canvas"),Rt.style.background="rgba(0,0,0,0)",Rt.width=Rt.height=c(ot/3),Ft=Rt.getContext("2d"),Ft.beginPath(),Ft.shadowColor=Q,Ft.shadowBlur=c(ot/5),Ft.fillStyle=Q,Ft.fillRect(c(Rt.width/2-ot/10),c(Rt.width/2-ot/10),c(ot/5),c(ot/5)),Ft.shadowBlur=0,Ft.closePath(),qt={i:0,h:0,x:tt+st,y:tt+st,step:3,stop:!1,K:!1,k:null,L(t){this.step=c(t/5*(rt/10))},l(){this.k=null;let t=1/0;for(let e in bots){let i=k(bots[e],this);if(bots[e].i===this.i&&bots[e].h===this.h)return void(this.k=e);let n=N.atan2(bots[e].y-this.y,bots[e].x-this.x);if(d(n,Gt.angle,G/16)){let n=[],o=new a(Nt.M-this.x,Nt.N-this.y);for(let s of ut){let t=g(s,o,this);t&&n.push({m:t,o:s})}n.length?(n.sort((t,e)=>k(t.m,this)-k(e.m,this)),k(n[0].m,this)>i&&i<t&&(this.k=e,t=i)):i<t&&(this.k=e,t=i)}}}},Et=[],Ht=[],Jt=new Array(mt),Nt={x:qt.x,y:qt.y},Gt={update(){for(let t in this)"function"!=typeof this[t]&&(this[t]=null);this.y=Nt.y-qt.y,this.x=Nt.x-qt.x,this.angle=N.atan2(this.y,this.x),this.angle<L&&this.angle>-L?this.right=!0:this.angle<3*L&&this.angle>L?this.O=!0:this.angle<-L&&this.angle>-3*L?this.P=!0:(this.angle<-3*L||this.angle>3*L)&&(this.left=!0)}};for(let h=0;h<mt;h++){Ht.push(new l(0,0,h));let t=[h];Jt[h]=JSON.parse(JSON.stringify(t))}for(let r=0;r<kt;r++){for(let t=0;t<mt;t++){if(Ht[t].r=0,Ht[t].v){let e=Jt[Ht[t].A].indexOf(t);Jt[Ht[t].A].splice(e,1),Ht[t].A=-1}Ht[t].v=0}for(let t=0;t<mt;t++)if(Ht[t].A==-1){Ht[t].A=0;for(let e=0;e<mt;e++)e!=t&&Ht[e].A===Ht[t].A&&(Ht[t].A++,e=-1);Jt[Ht[t].A].push(t)}for(let t=0;t<mt-1;t++)N.round(N.random())?Ht[t].r=1:Ht[t+1].A!=Ht[t].A&&T(Ht[t+1].A,Ht[t].A,Ht);Ht[mt-1].r=1;let e=new Array(mt).fill(0);for(let t=0;t<mt;t++)e[Ht[t].A]++;for(let t=0;t<mt;t++)N.round(N.random())&&e[Ht[t].A]>1&&(Ht[t].v=1,e[Ht[t].A]--);if(r===kt-1){for(let t=0;t<mt;t++)Ht[t].v=1,t+1<mt&&Ht[t].A!=Ht[t+1].A&&(Ht[t].r=0,T(Ht[t+1].A,Ht[t].A,Ht));Ht[mt-1].r=1}Et.push(JSON.parse(JSON.stringify(Ht)))}Ot={key38:!1,key40:!1,key39:!1,key37:!1,key87:!1,key83:!1,key68:!1,key65:!1},Lt=64*lt,Mt=0,Dt=0,Kt=0,Xt=0,Yt=0,jt=0,_t=0,zt=0;let u,y;for(let x=0;x<2;x++)for(let r=0;r<kt;r++)for(let h=0;h<mt;h++)0===r&&0===x&&(u=tt+h*ot,y=tt-Lt/2),0===h&&1===x&&(u=tt-Lt/2,y=tt+r*ot-Lt/2),1===Et[r][h].r&&1===x&&(u=tt+(h+1)*ot-Lt/2,y=tt+r*ot-Lt/2,h<mt-1&&(Kt=Xt=Yt=jt=_t=zt=0,0!==r&&1!==Et[r-1][h].r||(Kt=Lt),r===kt-1&&(Xt=Lt),!Kt&&r>0&&Et[r-1][h].v&&(Yt=Lt),r+1<kt&&Et[r][h].v&&(jt=Lt),!Kt&&r>0&&Et[r-1][h+1].v&&(_t=Lt),r+1<kt&&Et[r][h+1].v&&(zt=Lt),ut.push(new f(new a(u,y+Kt+Yt),new a(u,y+3*Lt-Xt-jt))),ut.push(new f(new a(u+Lt,y+Kt+_t),new a(u+Lt,y+3*Lt-Xt-zt))),r>0&&!Et[r-1][h].r&&ut.push(new f(new a(u,y),new a(u+Lt,y))),r+1<kt&&!Et[r+1][h].r&&ut.push(new f(new a(u,y+3*Lt),new a(u+Lt,y+3*Lt))))),1===Et[r][h].v&&0===x&&(u=tt+h*ot,y=tt+(r+1)*ot-Lt/2,r<kt-1&&(Mt=Dt=0,(1===Et[r][h].r||r+1<kt&&1===Et[r+1][h].r)&&(Mt=Lt/2),(0===h||1===Et[r][h-1].r||r+1<kt&&1===Et[r+1][h-1].r)&&(Dt=Lt/2),ut.push(new f(new a(u+Dt,y),new a(u-Mt+2*Lt,y))),ut.push(new f(new a(u+Dt,y+Lt),new a(u-Mt+2*Lt,y+Lt))),!Mt&&h+1<mt&&!Et[r][h+1].v&&ut.push(new f(new a(u+2*Lt,y),new a(u+2*Lt,y+Lt))),!Dt&&h>0&&!Et[r][h-1].v&&ut.push(new f(new a(u,y),new a(u,y+Lt)))));for(let r=0;r<ut.length;r++)if(ut[r])for(let h=0;h<ut.length;h++)ut[h]&&ut[h].D(ut[r])&&(ut[r].concat(ut[h]),ut[h]=null,h=-1);ut=ut.filter(t=>t),U.complete?s():U.onload=s,Qt=F(),o(ht),Ut=Qt.p,Vt=0,Zt=2,te=!0,D.fillStyle=Q,D.fillRect(0,0,Z,$),C("> reached internals.<br>> power loss detected.<br>> viewing range limited. <br>> provide power supply.<br>> WASD to move<br>> mouse to look around<br>> "),B()}function J(t){if(!it){if($t){let e=t-$t;qt.L(e),r(e),n(e),$t=t}else $t=t,et=t;D.fillRect(qt.x-at,qt.y-at,2*at,2*at),z.clearRect(0,0,Z,$),Ot.key87&&(Gt.right&&1!=Et[qt.i][qt.h].r&&gt.H>=ot&&gt.G>=ot&&gt.J>=ot&&(!qt.stop||3==qt.stop)&&(gt.H-=ot),Gt.P&&qt.i>0&&1!=Et[qt.i-1][qt.h].v&&gt.J>=ot&&gt.H>=ot&&gt.I>=ot&&(!qt.stop||2==qt.stop)&&(gt.J-=ot),Gt.O&&1!=Et[qt.i][qt.h].v&&gt.G>=ot&&gt.H>=ot&&gt.I>=ot&&(!qt.stop||4==qt.stop)&&(gt.G-=ot),Gt.left&&qt.h>0&&1!=Et[qt.i][qt.h-1].r&&gt.I>=ot&&gt.G>=ot&&gt.J>=ot&&(!qt.stop||1==qt.stop)&&(gt.I-=ot)),gt.H<ot?(qt.x+=qt.step,gt.H+=qt.step,gt.H>=ot&&qt.h++):gt.I<ot?(qt.x-=qt.step,gt.I+=qt.step,gt.I>=ot&&qt.h--):gt.J<ot?(qt.y-=qt.step,gt.J+=qt.step,gt.J>=ot&&qt.i--):gt.G<ot&&(qt.y+=qt.step,gt.G+=qt.step,gt.G>=ot&&qt.i++);for(let e in bots)!te&&bots[e].F||q(bots[e]),1===bots[e].F[bots[e].i][bots[e].h].dir?bots[e].dir=1:2===bots[e].F[bots[e].i][bots[e].h].dir?bots[e].dir=2:3===bots[e].F[bots[e].i][bots[e].h].dir?bots[e].dir=3:4===bots[e].F[bots[e].i][bots[e].h].dir?bots[e].dir=4:0===bots[e].F[bots[e].i][bots[e].h].dir&&(bots[e].dir=0,bots[e].s||(et=t,R(),bots[e].s=!0)),bots[e].q||(1===bots[e].dir?(bots[e].x-=Tt,st+tt+bots[e].h*ot-bots[e].x>=ot&&bots[e].h--):2===bots[e].dir?(bots[e].y-=Tt,st+tt+bots[e].i*ot-bots[e].y>=ot&&bots[e].i--):3===bots[e].dir?(bots[e].x+=Tt,bots[e].x-tt-bots[e].h*ot-st>=ot&&bots[e].h++):4===bots[e].dir&&(bots[e].y+=Tt,bots[e].y-tt-bots[e].i*ot-st>=ot&&bots[e].i++));D.globalCompositeOperation="destination-out",D.beginPath(),D.moveTo(qt.x,qt.y),D.arc(qt.x,qt.y,at,Gt.angle-L,Gt.angle+L),D.fill(),D.closePath(),D.globalCompositeOperation="source-over",p(ut.filter(t=>y(qt,t)<at),qt);for(let e of xt)P(e.a,e.b);if(Gt.update(),D.drawImage(Bt,c(qt.x-Bt.width/2),c(qt.y-Bt.width/2)),te=!1,0===yt.length?yt.push({h:0,i:0}):qt.h==yt[yt.length-1].h&&qt.i==yt[yt.length-1].i||(yt.length>1&&qt.h===yt[yt.length-2].h&&qt.i===yt[yt.length-2].i?(yt.pop(),te=!0,B(),R()):(yt.push({h:qt.h,i:qt.i}),te=!0,B(),R())),!te&&dt&&(R(),W()),D.beginPath(),yt.length>1){D.moveTo(S(yt[yt.length-2].h),S(yt[yt.length-2].i));let t=new a(qt.x-S(yt[yt.length-2].h),qt.y-S(yt[yt.length-2].i));t.x*=.9,t.y*=.9,D.lineTo(S(yt[yt.length-2].h)+t.x,S(yt[yt.length-2].i)+t.y)}else D.moveTo(S(0),40),D.lineTo(qt.x,qt.y-Bt.width/2);null===pt?(D.lineWidth=4,D.strokeStyle="#680002",D.stroke(),D.lineWidth=1,D.strokeStyle="#bc0010",D.stroke(),D.closePath()):(D.lineWidth=4,D.strokeStyle="#330000",D.stroke(),D.lineWidth=1,D.strokeStyle="#4d0000",D.stroke(),D.closePath()),z.beginPath(),z.arc(S(Qt.h),S(Qt.i),Vt,0,2*G),Vt+=Zt,(Vt>ot/2||Vt<2)&&(Zt=-Zt);let i=z.createRadialGradient(S(Qt.h),S(Qt.i),ot/16,S(Qt.h),S(Qt.i),ot/3);i.addColorStop(0,"#bc0010"),i.addColorStop(1,"transparent"),z.fillStyle=i,z.fill(),z.fillRect(S(Qt.h)-ot/16,S(Qt.i)-ot/16,ot/8,ot/8),z.closePath();for(let e in Pt)Pt[e].active&&(z.save(),z.translate(c(Pt[e].x),c(Pt[e].y)),z.rotate(Pt[e].arc),z.drawImage(St,0,0),Pt[e].arc-=bt,Pt[e].arc%=2*G,z.restore());for(let e in bots){let t=null,i=null;for(let n in Pt)if(Pt[n].active){if(Pt[n].k===e){t=e,i=n;break}if(!Pt[n].k&&k(Pt[n],bots[e])<=ct*ct&&(Pt[n].l(e),Pt[n].k===e)){t=e,i=n;break}}if(bots[e].q||qt.k==e||t==e)if(bots[e].q){z.beginPath(),z.fillStyle=Q;let t=bots[e].q*(ot/5)/ee;z.fillRect(bots[e].x-t/2,bots[e].y-t/2,t,t),z.closePath(),bots[e].q--,1===bots[e].q&&(bots[e].q=!1,qt.k===e&&(qt.k=null),i&&Pt[i].k===e&&(Pt[i].k=null),bots[e].u(),R())}else bots[e].q=ee;else z.drawImage(Rt,c(bots[e].x-Rt.width/2),c(bots[e].y-Rt.width/2))}if(qt.K){let t,e;qt.k?(t=bots[qt.k].x,e=bots[qt.k].y):(t=Nt.M,e=Nt.N),A(qt,{x:t,y:e})}for(let o in Pt){let t=Pt[o].k;t&&Pt[o].active&&A(Pt[o],bots[t])}if(wt){let t=new a(S(yt[tipWire].h),S(yt[tipWire].i)),e=new a(t.x-fixTip.x,t.y-fixTip.y),i=N.sqrt(v(e));fixTip.x+=e.x/i*(ot/8),fixTip.y+=e.y/i*(ot/8),z.beginPath(),z.lineWidth=2,z.strokeStyle="#1dfc81",z.moveTo(S(0),40+Bt.width/2);for(let n=0;n<tipWire;n++)z.lineTo(S(yt[n].h),S(yt[n].i));z.lineTo(fixTip.x,fixTip.y),z.stroke(),z.closePath(),k(fixTip,t)<ot*ot/16&&(tipWire===pt?wt=!1:tipWire==yt.length-1?(wt=!1,H(2,13,3)):(fixTip.x=t.x,fixTip.y=t.y,tipWire++))}}t-et<2e3&&D.drawImage(E(M),0,0),requestAnimationFrame(J)}const N=Math,G=N.PI,O=G/2,L=G/4,M=document.getElementById("c"),D=M.getContext("2d"),K=document.getElementById("c2"),X=K.getContext("2d"),Y=document.getElementById("c3"),j=Y.getContext("2d"),_=document.getElementById("c4"),z=_.getContext("2d");K.style.backgroundColor="#000";const Q="#000";let U=new Image;U.src="floor4.png";let V;const Z=M.width=K.width=Y.width=_.width=window.innerWidth,$=(window.innerHeight/2,M.height=K.height=Y.height=_.height=window.innerHeight),tt=100;let et,it,nt,ot,st,rt,ht,lt,at,ft,ct,dt,ut,yt,xt,bt,pt,wt,gt,mt,kt,vt,Pt,Tt,St,Ct,It,At,Bt,Wt,Rt,Ft,qt,Et,Ht,Jt,Nt,Gt,Ot,Lt,Mt,Dt,Kt,Xt,Yt,jt,_t,zt,Qt,Ut,Vt,Zt,$t,te,ee;U.onload=function(){function t(c){if(D.clearRect(0,0,Z,$),i?r||(c-i>500&&(s=!s,i=c),c-n>3e3&&(n=c,r=!0,f=!0,s=!1)):(i=c,n=c),s)D.beginPath(),D.shadowColor="white",D.shadowBlur=40,D.beginPath(),D.font="15px Courier New",D.fillStyle="#1dfc81",D.fillText("> Internal error",10,30),D.closePath();else if(r){if(D.shadowBlur=0,c-n>2e3&&(o-=.005,o<.5))return H(1,10,2),document.addEventListener("mousemove",function(t){let e=M.getBoundingClientRect();Nt.M=t.pageX-e.left,Nt.N=t.pageY-e.top;let i=new a(t.pageX-e.left-qt.x,t.pageY-e.top-qt.y),n=v(i);n<ft/4?(n=N.sqrt(n),Nt.x=qt.x+i.x*(.5*at/n),Nt.y=qt.y+i.y*(.5*at/n)):(Nt.x=t.pageX-e.left,Nt.y=t.pageY-e.top)}),document.addEventListener("keydown",function(t){if(Ot["key"+t.keyCode]=!0,118===t.keyCode&&(it=!it),32===t.keyCode){t.preventDefault();let e=!1;dt=!0;for(let i in Pt)if(Pt[i].active&&Pt[i].i===qt.i&&Pt[i].h===qt.h){Pt[i].j(),e=!0;break}if(!e)for(let i in Pt)if(Pt[i].g(qt.i,qt.h))break}}),document.addEventListener("mousedown",function(t){qt.K=!0,qt.l()}),document.addEventListener("mouseup",function(t){qt.K=!1}),document.addEventListener("keyup",function(t){Ot["key"+t.keyCode]=!1}),void J();!f&&c-i>h&&(f=!0,h=2e3*N.random(),i=c),f?(D.drawImage(E(e),0,$/2-1/o*300,4*Z/o,600/o),c-i>l&&(f=!1,i=c,l=250*N.random())):D.drawImage(e,0,$/2-1/o*300,4*Z/o,600/o)}requestAnimationFrame(t)}V=D.createPattern(U,"repeat");let e=document.createElement("canvas");e.width=4*Z,e.height=600,ictx=e.getContext("2d"),ictx.beginPath(),ictx.beginPath(),ictx.fillStyle="#000",ictx.fillRect(0,0,e.R,e.height),ictx.font="500px Courier New",ictx.strokeStyle="#1dfc81",ictx.lineWidth=4,ictx.fillStyle=V,ictx.fillText("Internal error",0,500),ictx.strokeText("Internal error",0,500),ictx.closePath();let i,n,o=2.5,s=!1,r=!1,h=1500*N.random(),l=500*N.random()+500,f=!1;t()},e.S=t}({},function(){return this}());